<preview>
<p>The goal of this article is to install a specific version of nodejs (with npm) on Ubuntu for a single user. There are at least a couple of reasons to install node.js this way:</p>
<ul>
	<li>to restrict the permissions of the node process(es) for security purposes</li>
	<li>to allow the use of multiple different versions of node on the same machine</li>
</ul>
<p>Alternative titles for this article could very well be <strong>&quot;How to Install Node.js as a Non-Root User&quot;</strong> or <strong>&quot;How to Install Node.js from Source&quot;</strong>.</p>

<p>For the sake of simplicity, we will use version 0.10.x of node.js in this article. If you're using a linux distribution other than Ubuntu, you can probably follow the instructions here, except with a few minor changes to match your distro's way of doing things.</p>
</preview>


<br>
<h3>Dependencies</h3>
<p>Install build dependencies:</p>
<pre class="code bash">
sudo apt-get install g++ make
</pre>


<br>
<h3>Create User</h3>
<p>Create a new user for each separate version of node.js that you wish to install. In this article we're installing node.js 0.10.x, so that's how we'll name this user:</p>
<pre class="code bash">
sudo useradd -d /home/nodejs-0.10.x -m nodejs-0.10.x
</pre>


<br>
<h3>Pre-Installation</h3>
<p>Open a su session as the nodejs-0.10.x user:</p>
<pre class="code bash">
sudo su - nodejs-0.10.x
</pre>

<p>Create the <span class="code">~/.npmrc</span> file:</p>
<pre class="code bash">
vim ~/.npmrc
</pre>

<p>Add the following lines to the <span class="code">~/.npmrc</span> file:</p>
<pre class="code bash">
root = /home/nodejs-0.10.x/.local/lib/node_modules
binroot = /home/nodejs-0.10.x/.local/bin
manroot = /home/nodejs-0.10.x/.local/share/man
</pre>

<p>Create the <span class="code">~/.local</span> directory:</p>
<pre class="code bash">
mkdir ~/.local
</pre>

<br>
<h3>Building Node.js from Source</h3>
<p>Download the latest 0.10.x release of nodejs. We'll use 0.10.29 here, because that was the latest stable release as of the time this article was written:</p>
<pre class="code bash">
wget https://github.com/joyent/node/archive/v0.10.29.tar.gz ~/
</pre>

<p>Unpack the gzipped archive:</p>
<pre class="code bash">
tar -xzvf ~/v0.10.29.tar.gz
</pre>

<p>Change directories into the directory that was just created:</p>
<pre class="code bash">
cd ~/node-0.10.29
</pre>
<p>Check that all dependencies are met by looking at the <span class="code">README.md</span> file.</p>

<p>Configure the build:</p>
<pre class="code bash">
./configure --prefix=~/.local
</pre>

<p>Initiate the build process:</p>
<pre class="code bash">
make
</pre>
<p>This will take a while.</p>


<br>
<h3>Installing Node.js</h3>
<p>Once the build process has finished, run the installation:</p>
<pre class="code bash">
make install
</pre>

<p>Add <span class="code">.node_modules</span> symlink:</p>
<pre class="code bash">
ln -s ~/.local/lib/node_modules ~/.node_modules
</pre>

<p>Add npm to the nodejs-0.10.x user's $PATH by adding the following to end of the <span class="code">~/.profile</span> file:</p>
<pre class="code bash">
export PATH=$HOME/.local/bin:$PATH
</pre>

<p>Exit the su session:</p>
<pre class="code bash">
exit
</pre>


<br>
<h3>Verifying the Installation</h3>
<p>Open a su session as the nodejs-0.10.x user:</p>
<pre class="code bash">
sudo su - nodejs-0.10.x
</pre>

<p>To verify that node was installed correctly:</p>
<pre class="code bash">
node -v
</pre>
<p>Should output the correct version number for node, like this:</p>
<pre class="code bash">
v0.10.29
</pre>

<p>And to verify that npm was installed correctly:</p>
<pre class="code bash">
npm -v
</pre>
<p>Should output the correct version number for npm, like this:</p>
<pre class="code bash">
1.2.30
</pre>

<p>Exit the su session:</p>
<pre class="code bash">
exit
</pre>


<br>
<h3>Clean up</h3>
<p>Once everything has been installed and is working properly, you can go ahead and delete the source files:</p>
<pre class="code bash">
rm -R /home/nodejs-0.10.x/node-0.10.29
rm /home/nodejs-0.10.x/v0.10.29.tar.gz
</pre>


<br>
<h3>Using a Specific Node.js Version</h3>

<p>Now anytime you wish to use a specific version of node.js that you've installed, you simply start a su session as that user:</p>
<pre class="code bash">
sudo su - nodejs-0.10.x
</pre>

<p>Then, to run a node app:</p>
<pre class="code bash">
node your-app.js
</pre>

<p>Or, to use npm:</p>
<pre class="code bash">
npm help
</pre>

<p>The specific version of node.js (and npm) that you just installed will only be available to that user. You can install any number of versions of node.js in this manner.</p>